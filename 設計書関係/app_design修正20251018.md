# 🧬 ASD 支援アプリ（仮称）システム設計書（現実版＋ AI 質問拡張）

**Version 0.5 / 2025-10-18**

---

## 0. 概要

本プロジェクトは、ASD（自閉スペクトラム症）や発達障害を持つ子どもが  
「日常生活の中で適切な行動を遊びながら学ぶ」ことを目的とした教育支援アプリである。

Streamlit を用いて、

- 子ども向け：ストーリーブック＋選択肢で体験的に行動学習
- 保護者向け：AI による行動理解・支援ヒント提供  
  を同一画面内で実現する。

---

## 1. コンセプト・目的

| 区分          | 内容                                                             |
| ------------- | ---------------------------------------------------------------- |
| 🌟 目的       | ASD 児が社会的場面での適切な行動を遊びながら理解できる環境を提供 |
| 🎮 コンセプト | 「日常スモールアドベンチャー」：行動選択 →AI フィードバック      |
| 📱 対応端末   | タブレット・PC・スマホ（Streamlit Web アプリ）                   |
| 🧠 開発方針   | 4 週間で MVP を構築。保護者向け機能は AI 対話形式で先行搭載。    |

---

## 1.1 教育的裏付け

本アプリの設計は、ASD（自閉スペクトラム症）児への支援において効果が実証されている以下の教育理論・手法に基づいています。これにより、子どもたちが遊びを通して自然に社会的な行動を学習できる環境を提供します。

| 理論・手法                              | 概要                                                                   | アプリ設計に活かせる部分                                                                         |
| :-------------------------------------- | :--------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- |
| **ABA（応用行動分析）**                 | 行動を「刺激 → 反応 → 結果」の流れで捉え、望ましい行動を強化する方法。 | ✅ 正しい行動を褒める<br>✅ 即時フィードバック<br>✅ 成功体験を可視化（スタンプ）                |
| **TEACCH（構造化教育）**                | 見通しを持てるように環境や手順を構造化して支援する方法。               | ✅ ステップ構造のストーリー進行<br>✅ 1 画面 1 タスクの設計<br>✅ 進行の視覚化（次の行動を予告） |
| **ソーシャルスキルトレーニング（SST）** | 社会場面での適切な行動を練習・ロールプレイで学ぶ方法。                 | ✅ ストーリーブック形式で疑似体験<br>✅ 選択肢を通じた「もしも」体験                             |

---

## 2. 想定ユーザー（MVP）

| 区分          | 想定人物像                                   | 利用目的                              |
| ------------- | -------------------------------------------- | ------------------------------------- |
| 👦 子ども本人 | 小〜中学生。ASD で軽度発達障害ももっている。 | 日常行動をゲーム感覚で学習。          |
| 👩 保護者     | 子どもの行動理解・支援方法の学習。           | AI との会話を通じて家庭支援力を強化。 |

---

## 3. MVP 機能範囲（4 週間）

| 機能分類          | 機能名                | 概要                                          | 優先度    |
| ----------------- | --------------------- | --------------------------------------------- | --------- |
| 🎯 子ども学習     | 行動クイズ＋ AI 判定  | ストーリー形式で行動選択 →AI がフィードバック | ⭐️⭐️⭐️ |
| 🧩 保護者学習     | AI 質問モード         | よくある疑問をクリック →AI が回答             | ⭐️⭐️⭐️ |
| 🎭 AI 人格モード  | 話し方切替（3 種類）  | ロジカルドクター／やさしい先生／応援コーチ    | ⭐️⭐️    |
| 👤 セッション管理 | ニックネーム＋一時 ID | Streamlit SessionState 管理                   | ⭐️⭐️    |
| 📊 学習状況可視化 | 進捗・行動分析表示    | 学習履歴、スタンプ獲得、行動傾向の可視化      | ⭐️⭐️    |

---

## 3.1 機能要件

### 3.1.1 子ども向け学習機能

- **イベント選択**: ユーザーはトップ画面で複数のイベント（例: トイレ、床屋、病院など）から学習したいシーンを選択できる。
- **ストーリー進行**: 選択されたイベントに基づいて、一連のストーリーが順番に表示される。
- **行動選択**: 各ストーリーシーンにおいて、子どもは提示された複数の選択肢の中から行動を選択できる。
- **AI フィードバック**: 選択された行動に対し、AI がポジティブなフィードバックを提供する（例：「よくできたね！」）。
- **スタンプ付与**: 適切な行動を選択するたびに、成功回数に応じてスタンプが付与される。
- **ふりかえり表示**: ストーリー完了後、その日の行動結果（良い行動の数など）と獲得したスタンプが表示される。

### 3.1.2 保護者向け AI 質問モード

- **AI 人格選択**: 保護者はサイドバーから 3 種類の AI 人格（ロジカルドクター、やさしい先生、応援コーチ）を選択できる。
- **質問候補表示**: サイドバーに ASD 支援に関する「よくある質問」がランダムに表示される。
- **AI 回答**: 選択された質問に対して、選択された AI 人格が回答を生成し、サイドバーに表示する。
- **自由質問機能（将来）**: テキスト入力による自由な質問も可能にする（Phase 2 以降）。

### 3.1.3 セッション管理機能

- **ニックネーム設定**: ユーザーはアプリ開始時にニックネームを設定できる。
- **一時 ID 発行**: ユーザーセッションごとに一時 ID を生成し、進捗状況の保存に利用する。
- **進捗状況保存**: 各イベントの学習進捗、獲得スタンプ数、AI との対話履歴をローカルに保存する。

### 3.1.4 保護者向け学習状況可視化・分析機能

子どもの学習進捗を保護者が把握し、適切な支援につなげるための可視化・分析機能を提供する。

- **学習履歴の表示**:
  - 日付ごとの学習記録（取り組んだイベント、完了したシーン数）を一覧表示する。
  - カレンダー形式で学習した日を可視化し、継続的な取り組みを確認できるようにする。
- **スタンプ獲得状況の可視化**:
  - 獲得したスタンプの総数と種類を表示する。
  - イベントごとのスタンプ獲得数を棒グラフまたは円グラフで可視化する。
- **行動傾向の分析**:
  - 各イベントでの「適切な行動」「許容される行動」「不適切な行動」の選択割合を表示する。
  - 特定のシーンで繰り返し困難を示している場合、「よく選ばれる行動パターン」として保護者に提示する。
  - 苦手なシーンや行動タイプを特定し、「重点的にサポートが必要な場面」としてハイライト表示する。
- **成長の記録**:
  - 初回プレイ時と最新プレイ時の行動選択の変化を比較表示する。
  - 「改善が見られたポイント」を自動的に抽出し、ポジティブなフィードバックとして保護者に提示する。
- **AI 対話履歴の確認**:

  - 保護者が AI に質問した内容と回答の履歴を時系列で表示する。
  - よく質問するトピックを分析し、関連する追加情報やリソースを提案する。

- **レポート出力（Phase 2 以降）**:
  - 週次・月次の学習サマリーレポートを自動生成する。
  - PDF 形式でのエクスポート機能を提供し、医療機関や教育機関との共有を容易にする。

## 3.2 非機能要件

### 3.2.1 パフォーマンス

- **応答速度**: 各画面遷移および AI の応答は、5 秒以内に完了すること。
- **AI 処理速度**: AI によるフィードバックおよび回答生成は、ストリーミングによる出力にて 3 秒以内に完了すること。
- **画像・音声読み込み**: ストーリー中の画像や音声は、スムーズに読み込まれ、表示・再生されること。

### 3.2.2 ユーザビリティ

- **直感的な UI**: 子どもでも直感的に操作できるシンプルな UI/UX を提供すること。
- **アクセシビリティ**: 読みやすいフォントサイズ、色のコントラスト、操作しやすいボタンサイズを考慮すること。
- **多端末対応**: タブレット、PC、スマートフォンなど、多様なデバイスで正常に動作すること（Streamlit の特性に依存）。

### 3.2.3 信頼性

- **データ保存**: ユーザーの学習進捗データは、セッション終了後も保持されること。
- **エラーハンドリング**: AI からの応答がない場合や、ネットワークエラー発生時に適切なメッセージを表示すること。
- **API 失敗時の対応**:
  - **ネットワークエラー/タイムアウト**: API 通信が失敗した場合、ユーザーに「通信エラーが発生しました。時間をおいて再度お試しください。」といったメッセージを表示し、再試行を促す。
  - **AI 応答エラー**: AI からの応答が予期しない形式であったり、無効な内容であった場合、ユーザーに「AI からの応答に問題が発生しました。別の質問をお試しください。」といったメッセージを表示する。
  - **リトライ**: 自動的なリトライ処理は行わず、ユーザーによる手動での再試行を基本とする。

### 3.2.4 拡張性

- **コンテンツ追加**: 新しいイベントやストーリー、質問内容を容易に追加できる構造であること。
- **AI モデル変更**: 将来的に AI モデルや API が変更されても、システム全体への影響が最小限であること。
- **データ保存方式**: ローカル JSON から Firebase などのクラウドデータベースへの移行を考慮したデータ構造であること。

### 3.2.5 保守性

- **コードの可読性**: Clean Code 原則に基づき、コメントや適切な命名規則を用いてコードの可読性を高めること。
- **ドキュメンテーション**: システム設計書、API 仕様書、デプロイ手順書などを整備すること。

---

## 3.3 データ構造設計

### 3.3.1 進捗データ (`progress.json`)

ユーザーの学習進捗および関連情報を保存するための JSON 構造を以下に示す。このファイルはユーザーの一時 ID ごとに作成・管理される。

```json
{
  "user_id": "一時ID (例: 0b9803ef)",
  "nickname": "ユーザーニックネーム (例: ゆうた)",
  "created_at": "アカウント作成日時 (ISO 8601形式)",
  "last_access": "最終アクセス日時 (ISO 8601形式)",
  "events": [
    {
      "event_name": "イベント名 (例: トイレ)",
      "current_scene": "現在のシーン番号 (0-based)",
      "good_actions_count": "適切な行動の回数",
      "acceptable_actions_count": "許容される行動の回数",
      "inappropriate_actions_count": "不適切な行動の回数",
      "stamps_earned": "獲得したスタンプ数",
      "completed": "イベント完了フラグ (boolean)",
      "first_played_at": "初回プレイ日時 (ISO 8601形式)",
      "last_played_at": "最終プレイ日時 (ISO 8601形式)",
      "play_count": "プレイ回数",
      "scene_history": [
        {
          "scene_number": "シーン番号",
          "selected_choice": "選択した行動",
          "evaluation": "評価 (appropriate/acceptable/inappropriate)",
          "timestamp": "選択日時 (ISO 8601形式)"
        }
      ]
    },
    {
      "event_name": "イベント名 (例: 床屋)",
      "current_scene": 0,
      "good_actions_count": 0,
      "acceptable_actions_count": 0,
      "inappropriate_actions_count": 0,
      "stamps_earned": 0,
      "completed": false,
      "first_played_at": null,
      "last_played_at": null,
      "play_count": 0,
      "scene_history": []
    }
  ],
  "ai_conversations": [
    {
      "timestamp": "会話日時 (ISO 8601形式)",
      "ai_mode": "AI人格モード (例: ロジカルドクター)",
      "question": "ユーザーからの質問内容",
      "answer": "AIからの回答内容",
      "topic_tags": ["タグ1", "タグ2"]
    }
  ],
  "daily_activity": [
    {
      "date": "日付 (YYYY-MM-DD形式)",
      "events_played": ["取り組んだイベント名のリスト"],
      "total_scenes_completed": "完了したシーン数",
      "stamps_earned": "その日に獲得したスタンプ数"
    }
  ]
}
```

### 3.3.2 FAQ データ (`faq_data.json`)

AI 質問モードで表示される質問の候補リストを保存するための JSON 構造を以下に示す。

```json
{
  "questions": [
    "ハサミの音を怖がるのはなぜ？",
    "待合室で落ち着かないときの対処法は？",
    "注射を嫌がるときの声かけは？",
    "スーパーで走り回ってしまうときどうする？"
  ]
}
```

---

## 3.4 子ども向け学習機能 AI 判定プロンプト設計

### 3.4.1 評価基準

AI は子どもの行動選択に対し、以下の基準に基づいてフィードバックを行う。

- **適切な行動**: 社会的規範や状況に合致した行動。ポジティブなフィードバックを与える。
- **許容される行動**: 適切とは言えないが、大きな問題はない行動。改善の余地があることを示唆するフィードバックを与える。
- **不適切な行動**: 社会的規範から逸脱し、問題を引き起こす可能性のある行動。穏やかに修正を促すフィードバックを与える。

### 3.4.2 システムプロンプト例

AI 判定の際に使用するシステムプロンプトの例を以下に示す。これは、各イベントやシーンの文脈に合わせて動的に生成されることを想定している。

```
あなたはASD（自閉スペクトラム症）の子ども向けの行動学習アプリのガイドです。子どもが選択した行動に対して、以下の指示に従ってフィードバックを提供してください。

-   **口調**: 肯定的な言葉を選び、優しく、励ますようなトーンで話してください。難しい言葉は避けてください。
-   **フィードバックの長さ**: 簡潔に1〜2文でまとめてください。
-   **絵文字の使用**: 感情を表現する絵文字を適度に含めて、親しみやすい印象にしてください。
-   **評価基準**:
    -   「適切な行動」の場合：「よくできたね！」「素晴らしい選択だよ！」など、直接的に褒めてください。
    -   「許容される行動」の場合：「それも一つの方法だね。次はこうしてみるのもいいかも！」など、肯定しつつより良い選択肢を優しく示唆してください。
    -   「不適切な行動」の場合：「うーん、それはちょっと違うかな。次はこのように考えてみようね。」など、行動を否定せず、改善点を具体的に優しく伝えてください。

現在のシーンの状況：
[ここに現在のシーンの詳細な状況を記述]

選択された行動：
[ここに子どもが選択した行動を記述]

AI判定のポイント：
[ここにAIが判断する際の具体的なポイントを記述（例：床屋で挨拶する、ハサミの音を怖がらずに伝えるなど）]

上記の情報を踏まえて、フィードバックを生成してください。
```

---

## 4. UI フロー構成案

### 🌈 画面 1：イベント選択（トップ）

```python
st.title("🌟 今日はどこへ行こう？")
event = st.radio("えらんでね", ["トイレ", "床屋", "病院", "公園", "身支度"])
if st.button("はじめる！"):
    st.session_state["event"] = event
    st.session_state["page"] = "story"
```

- イラスト＋効果音で場面を提示
- 選択後にシーン学習モードへ遷移

---

### 🚪 画面 2：ストーリーモード

```python
scene = st.session_state.get("scene", 0)
story = [
    {"text": "床屋さんについたよ。どうする？",
     "choices": ["こんにちはと言う", "だまって座る", "帰る"]},
    {"text": "ハサミの音がちょっとこわいね。どうする？",
     "choices": ["耳をおさえる", "大声を出す", "お店の人に伝える"]}
]
```

- 選択肢ごとに AI がポジティブフィードバック（例：「よくできたね！」）
- 成功回数に応じてスタンプ付与

---

### 🎁 画面 3：ふりかえり

```python
st.subheader("🎉 きょうのふりかえり")
st.image("stamp_smile.png", width=150)
st.write("◎ 3つのいい行動を見つけたね！")
```

---

## 5. 保護者向け AI 質問モード

### 💬 機能概要

- 右サイドバーに「よくある質問」をランダム表示
- 質問をクリック → 選択した AI 人格が回答
- 例：「ハサミの音を怖がるのはなぜ？」「注射を嫌がるときの声かけは？」など

---

### 🧠 モード構成

| モード                  | 特徴                                 | 想定ユーザー心理           |
| ----------------------- | ------------------------------------ | -------------------------- |
| 🩺 **ロジカルドクター** | 医者や心理士のように根拠重視で説明。 | 理論的に理解したい人       |
| 🍀 **やさしい先生**     | 小学校の先生のようにやわらかく説明。 | 日常支援の参考にしたい人   |
| 🌞 **応援コーチ**       | 明るく元気に励ましながら教える。     | 不安な気持ちを和らげたい人 |

---

### 🧩 Streamlit UI 例

```python
st.sidebar.header("🎭 AIの話し方をえらぶ")
ai_mode = st.sidebar.radio(
    "どんなAIに相談しますか？",
    ["🩺 ロジカルドクター", "🍀 やさしい先生", "🌞 応援コーチ"]
)

questions = ["ハサミの音を怖がるのはなぜ？", "待合室で落ち着かないときの対処法は？"]
selected_question = st.sidebar.radio("💡 気になる質問をえらんでください：", questions)

if st.sidebar.button("AIに聞く"):
    persona_prompt = AI_PERSONAS[ai_mode]
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": persona_prompt},
            {"role": "user", "content": selected_question}
        ]
    )
    st.sidebar.success(response.choices[0].message.content)
```

---

### 🧩 AI 人格プロンプト例

```python
AI_PERSONAS = {
    "🩺 ロジカルドクター": "あなたはASD支援に詳しい小児科医兼臨床心理士です。科学的根拠を示しつつ、論理的に説明してください。最後に「🔍参考の方向性」を1行で添えてください。",
    "🍀 やさしい先生": "あなたは小学校の先生です。やさしい言葉で、家庭でも実践できるように説明してください。難しい言葉は使わず、温かいトーンで話してください。",
    "🌞 応援コーチ": "あなたは明るい発達支援コーチです。元気な言葉と絵文字で励ましながら、行動の工夫を伝えてください。例：「すごいね！」「その気持ちわかるよ！」など。"
}
```

---

## 6. システム構成（MVP ＋ AI 拡張）

```
[ユーザー]
   │
   ▼
[Streamlitアプリ]
   ├─ 子ども向けストーリーモード
   ├─ AI判定（GPT-4o-mini）
   ├─ 保護者AI質問モード ←（新規）
   │     ├─ 質問候補生成
   │     └─ AI人格プロンプト選択
   └─ 結果表示／保存

[ローカル保存]
   └─ progress.json
```

---

## 7. 開発スケジュール（更新）

| 週         | 主なタスク                     | 成果物             |
| ---------- | ------------------------------ | ------------------ |
| **Week 1** | 子ども画面 UI ＋質問データ作成 | 基本画面完成       |
| **Week 2** | AI 判定＋フィードバック連携    | 行動クイズ実装     |
| **Week 3** | 保護者 AI 質問機能追加         | サイドバー動作確認 |
| **Week 4** | モード切替＋調整・デプロイ     | MVP 完成           |

---

## 8. 開発技術（更新）

| レイヤ   | 技術            | 備考                     |
| -------- | --------------- | ------------------------ |
| フロント | Streamlit       | 子ども／保護者 UI 両対応 |
| AI 応答  | GPT-4o-mini     | モード人格対応           |
| データ   | JSON 保存       | Firebase 移行前提構造    |
| デプロイ | Streamlit Cloud | 無料で実証可             |

---

## 9. まとめ

- 🎮 子どもはストーリーブックで行動を学ぶ
- 👩 保護者は AI に質問して行動の理解を深める
- 🎭 AI は 3 つの人格モードで柔軟に対応
- ⏱️ Streamlit のみで短期 MVP 開発が可能

---

## 10. 今後の拡張

| フェーズ | 内容                                  |
| -------- | ------------------------------------- |
| Phase 2  | 保護者ログ保存／FAQ 自動生成（RAG？） |
| Phase 3  | 行動分析＋ AI アドバイザー強化        |
| Phase 4  | 教師・支援者用ダッシュボード連携      |

---

## 11. フォルダ・ファイル構成案

### 11.1 プロジェクト全体構成

```
ASD_support_practice/
├── .streamlit/
│   └── config.toml              # Streamlit設定（テーマ、ポート番号など）
├── app/
│   ├── main.py                  # メインアプリケーションエントリーポイント
│   ├── pages/
│   │   ├── __init__.py
│   │   ├── event_selection.py  # イベント選択画面
│   │   ├── story_mode.py       # ストーリーモード画面
│   │   ├── review.py            # ふりかえり画面
│   │   └── parent_dashboard.py # 保護者用ダッシュボード画面
│   ├── components/
│   │   ├── __init__.py
│   │   ├── sidebar.py           # サイドバーコンポーネント（AI質問モード）
│   │   ├── stamp_display.py    # スタンプ表示コンポーネント
│   │   ├── progress_bar.py     # 進捗バー表示
│   │   └── feedback_display.py # AIフィードバック表示
│   ├── services/
│   │   ├── __init__.py
│   │   ├── ai_service.py        # AI判定・回答生成サービス
│   │   ├── progress_service.py # 進捗管理サービス
│   │   ├── session_service.py  # セッション管理サービス
│   │   └── analytics_service.py # 学習状況分析サービス
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py              # ユーザーモデル
│   │   ├── event.py             # イベントモデル
│   │   ├── scene.py             # シーンモデル
│   │   └── conversation.py      # AI会話履歴モデル
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── file_handler.py      # ファイル読み書き処理
│   │   ├── validator.py         # バリデーション処理
│   │   ├── date_utils.py        # 日付処理ユーティリティ
│   │   └── error_handler.py     # エラーハンドリング処理
│   └── config/
│       ├── __init__.py
│       ├── settings.py          # アプリ全体設定
│       ├── prompts.py           # AIプロンプト定義
│       └── constants.py         # 定数定義
├── data/
│   ├── events/
│   │   ├── toilet.json          # トイレイベントデータ
│   │   ├── barber.json          # 床屋イベントデータ
│   │   ├── hospital.json        # 病院イベントデータ
│   │   ├── park.json            # 公園イベントデータ
│   │   └── morning_routine.json # 身支度イベントデータ
│   ├── faq_data.json            # よくある質問データ
│   └── user_progress/           # ユーザー進捗データ保存先
│       └── .gitkeep
├── assets/
│   ├── images/
│   │   ├── events/
│   │   │   ├── toilet/          # トイレ関連画像
│   │   │   ├── barber/          # 床屋関連画像
│   │   │   ├── hospital/        # 病院関連画像
│   │   │   ├── park/            # 公園関連画像
│   │   │   └── morning/         # 身支度関連画像
│   │   ├── stamps/
│   │   │   ├── stamp_smile.png  # スマイルスタンプ
│   │   │   ├── stamp_star.png   # スタースタンプ
│   │   │   └── stamp_heart.png  # ハートスタンプ
│   │   └── ui/
│   │       ├── logo.png         # アプリロゴ
│   │       └── background.png   # 背景画像
│   └── sounds/
│       ├── success.mp3          # 成功時の効果音
│       ├── click.mp3            # クリック音
│       └── complete.mp3         # 完了音
├── tests/
│   ├── __init__.py
│   ├── test_ai_service.py       # AIサービステスト
│   ├── test_progress_service.py # 進捗管理テスト
│   ├── test_session_service.py  # セッション管理テスト
│   └── test_analytics_service.py # 分析サービステスト
├── docs/
│   ├── api_specification.md     # API仕様書
│   ├── deployment_guide.md      # デプロイ手順書
│   └── user_manual.md           # ユーザーマニュアル
├── scripts/
│   ├── setup_project.py         # プロジェクト初期セットアップスクリプト
│   ├── create_test_data.py      # テストデータ生成スクリプト
│   └── migrate_data.py          # データマイグレーションスクリプト
├── .env.example                 # 環境変数テンプレート
├── .gitignore                   # Git除外設定
├── requirements.txt             # Python依存パッケージ
├── README.md                    # プロジェクト概要
└── LICENSE                      # ライセンス情報
```

### 11.2 主要ファイルの役割

#### **11.2.1 アプリケーション層 (`app/`)**

##### `main.py`

- Streamlit アプリのエントリーポイント
- ページルーティング処理
- セッション初期化
- サイドバー（保護者 AI 質問モード）の表示制御

##### `pages/`

- **event_selection.py**: イベント選択画面（トップページ）の UI・ロジック
- **story_mode.py**: ストーリー進行と AI 判定フィードバック表示
- **review.py**: ふりかえり画面（スタンプ・行動結果の表示）
- **parent_dashboard.py**: 保護者向け学習状況可視化ダッシュボード

##### `components/`

- **sidebar.py**: AI 質問モード（質問候補表示、AI 人格選択、回答表示）
- **stamp_display.py**: スタンプ獲得状況の表示
- **progress_bar.py**: イベント進捗のプログレスバー
- **feedback_display.py**: AI 判定結果のフィードバック表示

##### `services/`

- **ai_service.py**: OpenAI API 呼び出し、プロンプト生成、レスポンス処理
- **progress_service.py**: ユーザー進捗データの読み書き、更新処理
- **session_service.py**: セッション管理、一時 ID 発行、ニックネーム管理
- **analytics_service.py**: 学習データの分析・可視化ロジック

##### `models/`

- **user.py**: ユーザー情報を扱うデータクラス
- **event.py**: イベント情報を扱うデータクラス
- **scene.py**: シーン情報・選択肢を扱うデータクラス
- **conversation.py**: AI 会話履歴を扱うデータクラス

##### `utils/`

- **file_handler.py**: JSON 読み書き、ファイル存在確認など
- **validator.py**: 入力値検証、データ整合性チェック
- **date_utils.py**: ISO 8601 形式の日時処理
- **error_handler.py**: エラーメッセージ表示、ログ記録

##### `config/`

- **settings.py**: アプリ全体の設定（API キー、パス、デフォルト値）
- **prompts.py**: AI 人格プロンプト、判定プロンプトの定義
- **constants.py**: 定数（イベント名リスト、スタンプ獲得条件など）

#### **11.2.2 データ層 (`data/`)**

##### `events/*.json`

各イベントのシーン構成・選択肢・評価基準を定義

**例: `barber.json`**

```json
{
  "event_name": "床屋",
  "description": "床屋さんでの行動を学ぶイベント",
  "scenes": [
    {
      "scene_number": 0,
      "text": "床屋さんについたよ。どうする？",
      "image": "assets/images/events/barber/scene_01.png",
      "choices": [
        {
          "text": "こんにちはと言う",
          "evaluation": "appropriate",
          "ai_feedback_hint": "挨拶はとても良い行動です"
        },
        {
          "text": "だまって座る",
          "evaluation": "acceptable",
          "ai_feedback_hint": "挨拶するともっと良いです"
        },
        {
          "text": "帰る",
          "evaluation": "inappropriate",
          "ai_feedback_hint": "せっかく来たのに残念です"
        }
      ]
    }
  ]
}
```

##### `faq_data.json`

保護者向け AI 質問モードの質問候補リスト（11.1 の 3.3.2 と同様）

##### `user_progress/`

ユーザーごとの進捗データを保存（`{user_id}.json`形式）

#### **11.2.3 アセット層 (`assets/`)**

##### `images/`

- **events/**: 各イベントのシーンごとのイラスト・画像
- **stamps/**: スタンプ画像（成功時に表示）
- **ui/**: アプリロゴ、背景画像など UI 素材

##### `sounds/`

- 効果音ファイル（成功音、クリック音など）

#### **11.2.4 テスト層 (`tests/`)**

各サービスの単体テストを配置（pytest 使用を想定）

#### **11.2.5 ドキュメント (`docs/`)**

- **api_specification.md**: AI サービスなど各モジュールの API 仕様
- **deployment_guide.md**: Streamlit Cloud へのデプロイ手順
- **user_manual.md**: 保護者・支援者向けの利用マニュアル

#### **11.2.6 スクリプト (`scripts/`)**

- **setup_project.py**: 初回セットアップ（フォルダ作成、サンプルデータ配置）
- **create_test_data.py**: テスト用の進捗データ生成
- **migrate_data.py**: データ構造変更時のマイグレーション処理

### 11.3 環境設定ファイル

#### `.env.example`

```bash
# OpenAI API設定
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=gpt-4o-mini

# アプリ設定
APP_TITLE=ASD支援アプリ
APP_VERSION=0.5
DEBUG_MODE=False

# データ保存先
DATA_DIR=./data
USER_PROGRESS_DIR=./data/user_progress
```

#### `requirements.txt`

```
streamlit>=1.28.0
openai>=1.0.0
python-dotenv>=1.0.0
pandas>=2.0.0
plotly>=5.17.0
pytest>=7.4.0
```

#### `.gitignore`

```
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env_a/
venv/

# 環境変数
.env

# ユーザーデータ
data/user_progress/*.json

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db

# Streamlit
.streamlit/secrets.toml
```

### 11.4 開発フロー

1. **Week 1**: 基本構造と UI 実装

   - `main.py`, `pages/`, `components/` の実装
   - イベントデータ（`data/events/`）作成
   - 基本画面の動作確認

2. **Week 2**: AI 連携機能

   - `services/ai_service.py` 実装
   - プロンプト定義（`config/prompts.py`）
   - AI 判定とフィードバック表示

3. **Week 3**: 保護者向け機能

   - `components/sidebar.py` 実装
   - FAQ 機能と AI 人格モード切替
   - `services/analytics_service.py` 実装

4. **Week 4**: 仕上げとデプロイ
   - テスト実施（`tests/`）
   - ドキュメント整備（`docs/`）
   - Streamlit Cloud へデプロイ

### 11.5 拡張性の考慮

#### Phase 2 以降の拡張に備えた設計

- **Firebase 連携**: `services/progress_service.py` を Firebase 対応に差し替え可能
- **RAG 対応**: `services/ai_service.py` に検索機能を追加
- **マルチテナント**: ユーザー ID ベースの設計で複数ユーザーに対応済み
- **多言語対応**: `config/constants.py` に言語設定を追加可能

---

**以上：Version 0.5 現実路線＋ AI 拡張案**
