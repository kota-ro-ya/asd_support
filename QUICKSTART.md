# 🚀 クイックスタートガイド

ASD 支援アプリをすぐに起動するための簡単なガイドです。

## ⚡ 5 分で始める

### ステップ 1: 環境変数の設定

1. `.env.example`をコピーして`.env`ファイルを作成：

```bash
cp .env.example .env
```

2. `.env`ファイルを開いて、OpenAI API キーと AI 機能の設定：

```env
# 必須設定
OPENAI_API_KEY=sk-your-actual-api-key-here

# AI生成機能の設定（オプション）
USE_AI_GENERATION=True                  # AI生成機能を有効化
AI_GENERATION_MAX_ATTEMPTS=3            # 生成試行の最大回数
AI_QUALITY_THRESHOLD=80                 # 品質スコアの閾値

# キャッシュ設定（オプション）
ENABLE_SCENARIO_CACHE=True              # キャッシュ機能を有効化
CACHE_EXPIRY_HOURS=24                   # キャッシュ有効期限（時間）
MAX_CACHE_SIZE=100                      # 最大キャッシュエントリ数

# 待ち時間アニメーション設定（オプション）
ENABLE_FUN_LOADING=True                 # 楽しいアニメーションを有効化
LOADING_ANIMATION_TYPE=auto             # アニメーションタイプ (auto/progress/animal/emoji/facts)
```

### ステップ 2: 依存パッケージのインストール

既存の仮想環境（`env_a`）を使用する場合：

```bash
source env_a/bin/activate  # macOS/Linux
# または
env_a\Scripts\activate  # Windows

pip install -r requirements.txt
```

新しい仮想環境を作成する場合：

```bash
python -m venv venv
source venv/bin/activate  # macOS/Linux
# または
venv\Scripts\activate  # Windows

pip install -r requirements.txt
```

### ステップ 3: アプリの起動

**方法 A: 起動スクリプトを使用（推奨・macOS/Linux）**

```bash
./run.sh
```

**方法 B: 直接起動**

```bash
streamlit run app/main.py
```

### ステップ 4: ブラウザでアクセス

アプリが起動すると、ブラウザが自動的に開きます。
手動でアクセスする場合は：

```
http://localhost:8501
```

## 🎮 使い方

### 初回起動時

1. **ニックネーム入力**: アプリが起動したら、ニックネームを入力して「はじめる！」をクリック
2. **モード選択**: 「子供向けモード」または「保護者向けモード」を選択
3. **イベント選択**: 学びたい場面（トイレ、床屋、病院、公園、身支度）を選択
4. **ストーリー体験**: シーンごとに選択肢を選んで、AI からフィードバックを受け取る
5. **ふりかえり**: 全シーン完了後、結果とスタンプを確認

### 🤖 AI バリエーション機能（新機能）

#### 子供向けモード

- **イベント選択画面**で「🤖 AI バリエーション」チェックボックスをオン
- 同じイベントでも毎回異なるシナリオが生成されます
- 多様な学習体験が可能になります

#### 保護者向けモード

- **シチュエーション選択画面**で「🤖 AI 生成」チェックボックスをオン
- 各イベントの「✨ 新規生成」ボタンで新しいシチュエーションを生成
- AI が実際に起こりうる様々な場面を作成します

### 🎨 楽しい待ち時間アニメーション（新機能）

子供が AI のフィードバックを待つ時間を楽しくする機能です。

#### アニメーションの種類

- **auto**（推奨）: 毎回ランダムに変わる
- **progress**: ステップごとのプログレスバー
- **animal**: かわいい動物の応援
- **emoji**: くるくる回る絵文字
- **facts**: 励ましの豆知識

#### 設定方法

`.env` ファイルで設定：

```env
# 有効化
ENABLE_FUN_LOADING=True

# タイプを選択（お子さんの好みに合わせて）
LOADING_ANIMATION_TYPE=auto
```

詳しくは [LOADING_ANIMATION_GUIDE.md](docs/LOADING_ANIMATION_GUIDE.md) をご覧ください。

### 👥 専門家チームによる高精度な回答（新機能）

保護者向けガイドでは、複数の専門家が協調して回答します。

#### 4 人の専門家チーム

- 🧠 **臨床心理士**（ASD 専門、経験 20 年）
- ⚕️ **小児科医**（発達障害専門）
- 🏫 **特別支援教育専門家**（ベテラン教師、15 年）
- 💙 **家族支援専門家**（家族療法士）

#### 特徴

- エビデンスベース：理論・研究に基づく回答
- 多角的視点：4 つの専門分野から総合的に回答
- 具体的：今日から実践できる方法を提示
- 出典明示：理論名、研究者名を明示

詳しくは [SPECIALIZED_AGENT_SYSTEM.md](docs/SPECIALIZED_AGENT_SYSTEM.md) をご覧ください。

### 保護者向け AI 相談（サイドバー・メインページ）

**どのページからでも**サイドバー（画面左）から専門家に質問できます。
メインページの「保護者向けシチュエーション別ガイド」でも同じ機能が使えます。

#### 機能

- **よくある質問**（サイドバー）：5 件のランダム質問から選択
- **自由に質問**：自分で質問を入力
- **回答モード選択**（3 つから選択）：
  - 💬 **1 人の専門家（早い・おすすめ）**：3-5 秒で回答開始
  - 👥 **4 人の専門家（順番に回答）**：すぐに開始、4 人が順番に表示
  - 🔄 **統合回答（総合的）**：15-20 秒後に統合した回答
- **口調選択**：
  - 😊 フレンドリー（おすすめ）：親しみやすく柔らかい表現
  - 📖 標準：専門的で形式的な表現

#### 特徴

- 🧠 臨床心理士 / ⚕️ 小児科医 / 🏫 特別支援教育 / 💙 家族支援
- **ストリーミング表示**：回答がリアルタイムで流れる
- **待ち時間ゼロ**（4 人モード）または**3 秒後から開始**（1 人モード）
- **多様な視点**：4 人の専門家が順番に回答（4 人モード）
- **統合的判断**：4 人の意見を統合した総合回答（統合モード）
- メインページとサイドバーで同じ高品質な専門家システム

#### 各モードの使い分け

| モード          | 速さ        | 詳しさ        | おすすめ用途           |
| --------------- | ----------- | ------------- | ---------------------- |
| 💬 1 人の専門家 | ⚡⚡⚡ 最速 | ⭐⭐ 十分     | 日常の疑問・迷ったとき |
| 👥 4 人の専門家 | ⚡⚡ 速い   | ⭐⭐⭐ 多角的 | 多様な意見が欲しいとき |
| 🔄 統合回答     | ⚡ やや遅い | ⭐⭐⭐⭐ 最高 | 重要な判断をするとき   |

## 🔧 トラブルシューティング

### OpenAI API キーのエラー

```
ValueError: OPENAI_API_KEY is not set in environment variables
```

**解決方法**: `.env`ファイルが存在し、正しい API キーが設定されているか確認してください。

### ポートが使用中

```
Port 8501 is already in use
```

**解決方法**: 別のポートを指定して起動：

```bash
streamlit run app/main.py --server.port 8502
```

### モジュールが見つからない

```
ModuleNotFoundError: No module named 'streamlit'
```

**解決方法**: 仮想環境が有効化されているか確認し、依存パッケージを再インストール：

```bash
pip install -r requirements.txt
```

## 📊 データの確認

### ユーザー進捗データ

ユーザーの進捗データは以下に保存されます：

```
data/user_progress/{user_id}.json
```

### AI 生成コンテンツのキャッシュ

AI 生成されたコンテンツは以下にキャッシュされます：

```
data/cache/scenario_cache.json    # シナリオキャッシュ
data/cache/situation_cache.json   # 保護者向けシチュエーションキャッシュ
```

### イベントデータの編集

イベント内容を変更する場合：

```
data/events/barber.json
data/events/toilet.json
...など
```

## 🎨 カスタマイズ

### AI のプロンプト調整

`app/config/prompts.py`を編集して AI の振る舞いを変更できます。

### 新しいイベントの追加

1. `data/events/`に新しい JSON ファイルを作成
2. `app/config/constants.py`の`EVENT_NAMES`と`EVENT_FILE_MAPPING`に追加

### UI テーマの変更

`.streamlit/config.toml`でカラーテーマを変更できます。

## 📝 次のステップ

### MVP 開発の第一歩として

現在の実装で以下を確認・改善していきます：

1. ✅ **子供向けイベント選択とストーリー進行**
2. ✅ **AI 判定とフィードバック**
3. ✅ **保護者向け AI 質問モード**

### 今後の拡張予定

- 🎨 イベント用の画像・イラスト追加
- 🔊 効果音の実装
- 📈 学習状況の可視化・分析機能強化
- 👨‍👩‍👧 保護者用ダッシュボード
- 🌐 多言語対応

## 💡 ヒント

- **開発モード**: `.env`で`DEBUG_MODE=True`に設定すると詳細なログが表示されます
- **データリセット**: `data/user_progress/`内の JSON ファイルを削除すると進捗がリセットされます
- **キャッシュクリア**: `data/cache/`内のファイルを削除すると AI 生成キャッシュがリセットされます
- **AI 生成の無効化**: `.env`で`USE_AI_GENERATION=False`に設定すると固定テンプレートのみ使用されます
- **品質調整**: `AI_QUALITY_THRESHOLD`の値を変更して AI 生成コンテンツの品質基準を調整できます

## 📖 詳細ドキュメント

より詳しい情報は以下のドキュメントを参照してください：

- **AI Agent Implementation**: `docs/AI_AGENT_IMPLEMENTATION.md` - AI エージェントシステムの詳細
- **File Overview**: `docs/FILE_OVERVIEW.md` - ファイル構成の説明
- **Implementation Summary**: `docs/IMPLEMENTATION_SUMMARY.md` - 実装の全体像

## 🤝 サポート

質問や問題がある場合は、プロジェクトの Issues セクションで報告してください。

---

**🌟 楽しい学習体験を！ 🌟**
