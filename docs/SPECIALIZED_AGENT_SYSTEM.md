# 専門エージェントシステム - プロンプト設計による高精度化

## 🎯 目的

**課題**：手元に専門的なデータがない状態で、AI からの回答精度を高める

**解決策**：プロンプトエンジニアリングによる専門家エージェントシステム

---

## 💡 コア・アイデア

### AI の事前学習を「専門化」する

```
【従来】
AI（汎用） → 一般的な回答

【改善後】
AI（汎用）
  ↓ プロンプトで役割設定
  ↓
臨床心理士エージェント → 専門的な回答（心理・行動）
小児科医エージェント → 専門的な回答（医学）
特別支援教育専門家エージェント → 専門的な回答（教育）
家族支援専門家エージェント → 専門的な回答（家族）
  ↓
統合 → 高精度な総合回答
```

---

## 🏗️ システム構成

### 4 人の専門家エージェント

| エージェント              | 役割                   | 専門分野                                       |
| ------------------------- | ---------------------- | ---------------------------------------------- |
| 🧠 **臨床心理士**         | ASD 専門（経験 20 年） | ABA, TEACCH, SST, 感覚統合療法                 |
| ⚕️ **小児科医**           | 発達障害専門           | DSM-5, 神経学, 併存症, 発達評価                |
| 🏫 **特別支援教育専門家** | ベテラン教師（15 年）  | IEP, 合理的配慮, インクルーシブ教育            |
| 💙 **家族支援専門家**     | 家族療法士             | ペアトレ, 保護者メンタルヘルス, きょうだい支援 |

---

## 🔑 プロンプト設計の工夫

### 1. 役割の明確化

```python
"あなたは20年の経験を持つASD専門の臨床心理士です。"
```

→ AI が「臨床心理士」として振る舞う

### 2. 専門知識の明示

```python
【専門分野】
- 応用行動分析(ABA) - Lovaas(1987)の早期介入研究
- TEACCH プログラム - Mesibov らの構造化アプローチ
- ソーシャルスキルトレーニング(SST)
- 感覚統合療法 - Ayres の感覚処理理論
```

→ AI がこれらの理論を参照して回答

### 3. 回答の原則

```python
【回答の原則】
1. エビデンスベース：必ず研究・理論に基づく情報を提供
2. 個別性の尊重：「お子さんによって異なりますが」を前提に
3. 段階的アプローチ：スモールステップを重視
4. 保護者へのエンパワメント：責めずに寄り添う姿勢
```

→ 回答の「質」を担保

### 4. 引用すべき理論・研究の指定

```python
【引用すべき理論・研究】
- Lovaas, O. I. (1987): ABAの効果
- Mesibov, G. B.: TEACCH プログラム
- Gray, C.: ソーシャルストーリー
- Ayres, A. J.: 感覚統合理論
```

→ 「◯◯ 理論によると...」を自動生成

### 5. 禁止事項の明示

```python
【禁止事項】
- 「治る」「普通になる」などの表現
- 一般論のみの回答（必ず具体的な手法を含める）
- 保護者を責める表現
- 安易な「大丈夫」「心配ない」
```

→ 不適切な回答を防止

---

## 📊 従来との比較

### 比較表

| 項目             | 従来の AI | RAG                  | 専門エージェントシステム |
| ---------------- | --------- | -------------------- | ------------------------ |
| **データ依存度** | 低        | 高（知識ベース必須） | 低（プロンプトのみ）     |
| **初期コスト**   | 低        | 高（データ構築）     | 低（プロンプト作成）     |
| **保守コスト**   | 低        | 高（データ更新）     | 低（プロンプト調整）     |
| **専門性**       | 低〜中    | 高（データ次第）     | 高                       |
| **柔軟性**       | 高        | 低（データに制限）   | 高                       |
| **出典明示**     | なし      | あり                 | 理論名・研究者名         |
| **信頼性**       | 中        | 高                   | 高                       |

---

## 🎨 回答の質の違い

### 例：「バリカンの音で泣きます」

#### 従来の AI（汎用）

```
大変ですね。少しずつ慣れさせていくといいですよ。
最初は短時間から始めて、徐々に時間を伸ばしましょう。
```

**問題点**：

- 一般的すぎる
- 根拠がない
- 具体性に欠ける

---

#### 専門エージェントシステム

**🧠 臨床心理士の見解**：

```
## 🧠 専門的見解
感覚過敏への対応が必要です。Ayres(1972)の感覚統合理論によると、
ASDのお子さんは聴覚刺激を過剰に処理してしまい、バリカンのような
予測不能な音は扁桃体を強く刺激し、パニック反応を引き起こします。

## 💡 具体的な方法
【段階的脱感作法（systematic desensitization）】
1. まず、バリカンの「写真」を見せる（視覚のみ）
2. 次に、バリカンの「音」を動画で聞く（視聴覚）
3. 実物のバリカンを「見る」だけ（距離を保つ）
4. 電源オフのバリカンを「触る」
5. 電源オンで「音を聞く」（イヤーマフ使用）
6. 短時間（5秒）の使用
7. 徐々に時間を延長

各ステップは1週間以上かけ、無理は禁物です。

## ⚠️ 注意点
強制すると「トラウマ化」し、床屋恐怖症（tonsurephobia）になる
リスクがあります。お子さんのペースを最優先してください。

## 📚 参考情報
- Ayres, A. J. (1972). Sensory Integration and Learning Disorders
- Wolpe, J. (1958). Systematic Desensitization
```

**⚕️ 小児科医の見解**：

```
## ⚕️ 専門的見解
聴覚過敏は神経学的な要因です。ASDでは、前頭葉による「音のフィルタリング」
機能が弱く、すべての音が同じ強さで脳に届いてしまいます。
バリカンは約70-80dBの音圧で、感覚過敏があると90-100dBに感じられます。

## 💡 具体的な方法
【医学的に有効なアプローチ】
1. イヤーマフ（NRR25-30のもの）で音圧を30dB軽減
2. ノイズキャンセリングイヤホンで特定周波数をカット
3. 耳栓との併用も効果的

【バリカンの選択】
静音タイプ（50-60dB）のものに変更を理容師に依頼。
Panasonic ER-GP82などが該当します。

## ⚠️ 注意点
以下の場合は小児科医に相談を：
- パニックが1時間以上続く
- 自傷行為が見られる
- 日常生活の複数の音に過敏

聴覚過敏は併存する不安障害の可能性もあります。

## 📚 参考情報
- DSM-5: Sensory Processing Disorder
- 日本小児神経学会「感覚過敏ガイドライン」(2020)
```

**🏫 特別支援教育専門家の見解**：

```
## 🏫 専門的見解
学校でも同様の配慮が必要です。文部科学省の「合理的配慮」として、
感覚過敏への対応は法的に認められています（障害者差別解消法）。

## 💡 具体的な方法
【視覚支援の活用】
1. 「床屋の絵カード」を作成（手順を可視化）
2. ソーシャルストーリー（Gray, 1991）で事前学習
   「床屋さんでバリカンの音がします。私はイヤーマフをつけます。」
3. タイムタイマーで「あと◯分」を視覚化

【学校との連携】
担任の先生に以下を伝える：
- 避難訓練のサイレンも同様に苦手
- 運動会のピストル音への配慮
- 音楽室でのドラムなども注意

## ⚠️ 注意点
学校行事（運動会、学芸会など）では事前に音の確認を。
クールダウンスペースの確保も依頼しましょう。

## 📚 参考情報
- 文科省「合理的配慮の具体例」(2012)
- Gray, C. (1991). Social Stories
```

**💙 家族支援専門家の見解**：

```
## 💙 専門的見解
保護者の皆さま、お疲れさまです。「床屋に行けない」ことで
ご自身を責めていませんか？これはお子さんの特性であり、
保護者の育て方の問題ではありません。

## 💡 具体的な方法
【保護者のセルフケア】
- 訪問理容サービスの活用（自宅で短時間カット）
- レスパイトケア：祖父母や支援者に協力を依頼
- 完璧を求めない：髪型より心の安定を優先

【きょうだい児への配慮】
兄弟がいる場合、「お兄ちゃん/お姉ちゃんは我慢」になりがち。
きょうだいも別日に床屋に行くなど、個別の時間を確保しましょう。

【夫婦での役割分担】
一方の親が理容師と相談、もう一方がお子さんと外で待つなど、
役割を明確にすることでストレス軽減につながります。

## ⚠️ 注意点
保護者自身の心の健康も大切です。「できない」ことより
「できていること」に目を向けましょう。

## 📚 参考情報
- Winnicott, D. W.: "Good enough parent"（十分に良い親）
- ペアレント・トレーニング（前田・佐藤モデル）
```

---

**👥 統合回答**：

```
## 📋 専門家の共通見解
バリカンの音への恐怖は「感覚過敏」という神経学的な特性であり、
保護者の育て方の問題ではありません。無理に慣れさせるのではなく、
段階的な脱感作と環境調整が必要です。

## 🔍 それぞれの専門的視点

### ⚕️ 医学的観点
聴覚過敏は脳の「音のフィルタリング」機能の弱さによるものです。
イヤーマフ（NRR25-30）で音圧を30dB軽減でき、静音バリカン（50-60dB）
への変更も効果的です。

### 🧠 心理・行動的観点
段階的脱感作法が有効です。写真 → 動画 → 実物 → 音 → 短時間使用と、
各ステップ1週間以上かけてスモールステップで進めます。

### 🏫 教育的観点
視覚支援（絵カード、ソーシャルストーリー）で事前学習を。
学校でも同様の配慮（避難訓練、運動会など）が必要です。

### 💙 家族支援の観点
訪問理容サービスの活用や、保護者自身のセルフケアも重要です。
完璧を求めず、「十分に良い親」を目指しましょう。

## 💡 具体的なアクションプラン

1. **最優先：イヤーマフの購入**
   - NRR25-30のものを選ぶ
   - 自宅で慣れさせる（毎日5分装着練習）

2. **次のステップ：段階的練習**
   - 週1回、バリカンの写真/動画を見せる
   - 無理のないペースで進める

3. **並行して：環境調整**
   - 理容師に静音バリカンの相談
   - 訪問理容サービスの検討

4. **長期的に：学校との連携**
   - 担任に感覚過敏を説明
   - 運動会などの配慮を依頼

## ⚠️ 注意点・専門家への相談が必要な場合

以下の場合は専門家に相談を：
- パニックが1時間以上続く
- 自傷行為が見られる
- 日常生活の複数の音に過敏
- 保護者のストレスが限界

小児科医、臨床心理士、または療育機関へご相談ください。

## 📚 参考情報

**理論・研究**
- Ayres, A. J. (1972). Sensory Integration and Learning Disorders
- Wolpe, J. (1958). Systematic Desensitization
- Gray, C. (1991). Social Stories

**ガイドライン**
- DSM-5: Sensory Processing Disorder
- 日本小児神経学会「感覚過敏ガイドライン」(2020)
- 文科省「合理的配慮の具体例」(2012)

**支援プログラム**
- ペアレント・トレーニング（前田・佐藤モデル）
- TEACCH プログラム（Mesibov, G. B.）

---
💙 **保護者の皆さまへ**

床屋に行けないことで、ご自身を責めていませんか？
これはお子さんの「特性」であり、保護者の「失敗」ではありません。
一歩一歩、お子さんのペースで進めていきましょう。
完璧な親である必要はありません。「十分に良い親」で大丈夫です。
```

---

## 🎯 このアプローチの強み

### 1. データ不要

- 手元に専門文献がなくても OK
- プロンプトのみで実装可能
- 初期コストが低い

### 2. 高い専門性

- 4 人の専門家視点
- 理論・研究の引用
- エビデンスベース

### 3. 柔軟性

- プロンプト調整で簡単にカスタマイズ
- 新しい専門家エージェントを追加可能
- 最新の知見を反映しやすい

### 4. 保守性

- データベース不要
- プロンプト変更のみで更新
- メンテナンスが容易

---

## 🚀 使い方

### 基本的な使用

```python
from app.services.specialized_agent_service import SpecializedAgentService

# サービスの初期化
service = SpecializedAgentService()

# 質問と背景
question = "バリカンの音で泣いてしまいます"
context = "床屋で子どもがパニックになります"

# 統合回答を生成
result = service.generate_comprehensive_response(
    question=question,
    context=context
)

# 結果
print(result['synthesized_response'])
```

### 個別の専門家から回答

```python
# 臨床心理士のみ
response = service.generate_expert_response(
    agent_id="clinical_psychologist",
    question=question,
    context=context
)
```

---

## 📈 今後の拡張案

### 1. 専門家の追加

```python
# 新しいエージェントを追加
"occupational_therapist": {
    "name": "作業療法士",
    "icon": "🤲",
    "role": "感覚統合専門の作業療法士",
    ...
}
```

### 2. RAG とのハイブリッド

```python
# RAGで関連情報を取得
rag_context = rag_service.retrieve_relevant_context(query)

# プロンプトに追加情報として含める
context = f"{original_context}\n\n【関連情報】\n{rag_context}"
```

### 3. ファインチューニング

将来的に実際の相談データが蓄積されたら：

- 実際の質問-回答ペアでファインチューニング
- さらに精度向上

---

## 💡 まとめ

### この方法の本質

**「AI の汎用知識」を「プロンプト設計」で「専門化」する**

- データがなくても高精度
- 保守が容易
- 柔軟にカスタマイズ可能

### RAG との使い分け

| 用途                   | 推奨方法                                          |
| ---------------------- | ------------------------------------------------- |
| **手元にデータがない** | ✅ 専門エージェントシステム                       |
| **専門文献がある**     | ✅ RAG                                            |
| **最新情報が必要**     | ✅ RAG + Web スクレイピング                       |
| **柔軟性重視**         | ✅ 専門エージェントシステム                       |
| **精度と引用重視**     | ✅ RAG + 専門エージェントシステム（ハイブリッド） |

---

**最終更新**: 2025 年 11 月 1 日  
**バージョン**: 1.0  
**実装**: `app/services/specialized_agent_service.py`
