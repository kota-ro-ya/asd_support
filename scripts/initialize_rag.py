#!/usr/bin/env python3
"""
RAGçŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ã€æ³¨æ„ã€‘ç¾åœ¨ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã€‚
ç†ç”±ï¼šå°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆapp/services/specialized_agent_service.pyï¼‰ã®æ–¹ãŒ
      å°‘é‡ã®RAGãƒ‡ãƒ¼ã‚¿ã‚ˆã‚Šã‚‚é«˜ç²¾åº¦ãªå›ç­”ã‚’ç”Ÿæˆã§ãã‚‹ãŸã‚ã€‚

ã€å°†æ¥ã®æ‹¡å¼µç”¨ã€‘
ä»¥ä¸‹ã®å ´åˆã«ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å¾©æ´»ã•ã›ã‚‹ä¾¡å€¤ãŒã‚ã‚Šã¾ã™ï¼š
1. å®Ÿéš›ã®å°‚é–€æ–‡çŒ®PDFï¼ˆ100ä»¶ä»¥ä¸Šï¼‰ã‚’å…¥æ‰‹ã—ãŸå ´åˆ
2. å…¬çš„æ©Ÿé–¢ã®Webã‚µã‚¤ãƒˆã‹ã‚‰ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹å ´åˆ
3. æœ€æ–°ã®ç ”ç©¶è«–æ–‡ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨é€£æºã™ã‚‹å ´åˆ

ãã®éš›ã¯ã€å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨ä½µç”¨ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼‰ã™ã‚‹ã“ã¨ã§
ã•ã‚‰ã«ç²¾åº¦ã®é«˜ã„å›ç­”ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ç¾åœ¨ã®åˆæœŸçŸ¥è­˜ï¼ˆä¸‹è¨˜ï¼‰ã¯æ¶ç©ºã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚Šã€å®Ÿç”¨çš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
"""

import sys
from pathlib import Path

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’ãƒ‘ã‚¹ã«è¿½åŠ 
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from app.services.rag_service import RAGService


def load_initial_knowledge():
    """åˆæœŸçŸ¥è­˜ã‚’èª­ã¿è¾¼ã‚€"""
    
    # ASDæ”¯æ´ã«é–¢ã™ã‚‹åŸºç¤çŸ¥è­˜
    knowledge_base = [
        {
            "content": """
ASDã®æ„Ÿè¦šéæ•ã«ã¤ã„ã¦ï¼š
ASDï¼ˆè‡ªé–‰ã‚¹ãƒšã‚¯ãƒˆãƒ©ãƒ ç—‡ï¼‰ã®ãŠå­ã•ã‚“ã¯ã€è´è¦šã€è§¦è¦šã€è¦–è¦šãªã©ã®æ„Ÿè¦šãŒ
é€šå¸¸ã‚ˆã‚Šã‚‚æ•æ„Ÿã§ã‚ã‚‹ã“ã¨ãŒå¤šãã€æ—¥å¸¸çš„ãªéŸ³ã‚„åˆºæ¿€ãŒè‹¦ç—›ã«æ„Ÿã˜ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ç‰¹ã«äºˆæ¸¬ã§ããªã„å¤§ããªéŸ³ï¼ˆãƒãƒªã‚«ãƒ³ã€ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼ã€æƒé™¤æ©Ÿãªã©ï¼‰ã¯å¼·ã„ä¸å®‰ã‚„ãƒ‘ãƒ‹ãƒƒã‚¯ã‚’
å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

å¯¾å¿œã®ãƒã‚¤ãƒ³ãƒˆï¼š
- äº‹å‰ã«éŸ³ãŒå‡ºã‚‹ã“ã¨ã‚’äºˆå‘Šã™ã‚‹
- ã‚¤ãƒ¤ãƒ¼ãƒãƒ•ã‚„ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚°ã‚¤ãƒ¤ãƒ›ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹
- ç„¡ç†ã«æ…£ã‚Œã•ã›ã‚ˆã†ã¨ã—ãªã„
- ç’°å¢ƒã‚’èª¿æ•´ã™ã‚‹ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°éŸ³ã®åŸå› ã‚’é™¤å»ï¼‰
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "æ„Ÿè¦šéæ•",
                "source": "ASDæ”¯æ´ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³"
            }
        },
        {
            "content": """
äº‹å‰äºˆå‘Šã®é‡è¦æ€§ï¼š
ASDã®ãŠå­ã•ã‚“ã¯ã€äºˆæ¸¬å¯èƒ½æ€§ãŒã‚ã‚‹ã¨å®‰å¿ƒã—ã¾ã™ã€‚ã“ã‚Œã‹ã‚‰ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’
äº‹å‰ã«ä¼ãˆã‚‹ã“ã¨ã§ã€ä¸å®‰ã‚’å¤§å¹…ã«è»½æ¸›ã§ãã¾ã™ã€‚

åŠ¹æœçš„ãªäº‹å‰äºˆå‘Šã®æ–¹æ³•ï¼š
1. è¦–è¦šçš„ãªæ‰‹é †æ›¸ã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã†
2. ã€Œæ¬¡ã¯ã€‡ã€‡ã‚’ã—ã¾ã™ã€ã¨å…·ä½“çš„ã«ä¼ãˆã‚‹
3. ã‚¿ã‚¤ãƒ ã‚¿ã‚¤ãƒãƒ¼ã§æ®‹ã‚Šæ™‚é–“ã‚’è¦‹ã›ã‚‹
4. å®Ÿéš›ã®å ´æ‰€ã‚„é“å…·ã‚’è¦‹ã›ã‚‹ï¼ˆå¯èƒ½ãªå ´åˆï¼‰
5. ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§äº‹å‰å­¦ç¿’ã™ã‚‹

è¦–è¦šæ”¯æ´ã¨ä½µç”¨ã™ã‚‹ã¨ã€ã•ã‚‰ã«åŠ¹æœçš„ã§ã™ã€‚
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "äº‹å‰äºˆå‘Š",
                "source": "ç™‚è‚²å®Ÿè·µã‚¬ã‚¤ãƒ‰"
            }
        },
        {
            "content": """
è¦–è¦šæ”¯æ´ã®åŠ¹æœï¼š
ASDã®ãŠå­ã•ã‚“ã®å¤šãã¯è¦–è¦šæƒ…å ±ã®å‡¦ç†ãŒå¾—æ„ã§ã™ï¼ˆè¦–è¦šå„ªä½ï¼‰ã€‚
æ‰‹é †ã‚’çµµã‚«ãƒ¼ãƒ‰ã‚„ã‚¤ãƒ©ã‚¹ãƒˆã€å†™çœŸã§ç¤ºã™ã“ã¨ã§ã€ç†è§£ãŒæ·±ã¾ã‚Šã€
è¦‹é€šã—ãŒæŒã¦ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

è¦–è¦šæ”¯æ´ã®ä¾‹ï¼š
- çµµã‚«ãƒ¼ãƒ‰ï¼ˆã‚¤ãƒ©ã‚¹ãƒˆã§æ‰‹é †ã‚’è¡¨ã™ï¼‰
- å†™çœŸã‚«ãƒ¼ãƒ‰ï¼ˆå®Ÿéš›ã®å ´æ‰€ã‚„ç‰©ã®å†™çœŸï¼‰
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰ï¼ˆä¸€æ—¥ã®æµã‚Œã‚’å¯è¦–åŒ–ï¼‰
- ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆçµ‚ã‚ã£ãŸã‚‰âœ“ã‚’ã¤ã‘ã‚‹ï¼‰
- ã‚¿ã‚¤ãƒ ã‚¿ã‚¤ãƒãƒ¼ï¼ˆæ®‹ã‚Šæ™‚é–“ã‚’è¦–è¦šçš„ã«è¡¨ç¤ºï¼‰

ã“ã‚Œã«ã‚ˆã‚Šä¸å®‰ãŒè»½æ¸›ã•ã‚Œã€é©åˆ‡ãªè¡Œå‹•ã‚’ã¨ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "è¦–è¦šæ”¯æ´",
                "source": "TEACCH ãƒ—ãƒ­ã‚°ãƒ©ãƒ "
            }
        },
        {
            "content": """
ã”è¤’ç¾ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ã‚³ãƒãƒŸãƒ¼ï¼‰ï¼š
é©åˆ‡ãªè¡Œå‹•ã«å¯¾ã—ã¦å³åº§ã«ã”è¤’ç¾ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€ãã®è¡Œå‹•ãŒå¼·åŒ–ã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã¯å¿œç”¨è¡Œå‹•åˆ†æï¼ˆABAï¼‰ã®åŸºæœ¬åŸç†ã§ã™ã€‚

åŠ¹æœçš„ãªã”è¤’ç¾ã‚·ã‚¹ãƒ†ãƒ ï¼š
1. å³åº§æ€§ï¼šè‰¯ã„è¡Œå‹•ã®ç›´å¾Œã«ã”è¤’ç¾ã‚’ä¸ãˆã‚‹
2. ä¸€è²«æ€§ï¼šæ¯å›åŒã˜ãƒ«ãƒ¼ãƒ«ã§é‹ç”¨ã™ã‚‹
3. è¦–è¦šåŒ–ï¼šã‚·ãƒ¼ãƒ«ã‚„ã‚¹ã‚¿ãƒ³ãƒ—ã§é€²æ—ã‚’è¦‹ãˆã‚‹åŒ–
4. å­ã©ã‚‚ãŒå¥½ããªã‚‚ã®ï¼šæœ¬äººãŒå–œã¶ã”è¤’ç¾ã‚’é¸ã¶
5. æ®µéšçš„ï¼šå°ã•ãªç›®æ¨™ã‹ã‚‰å§‹ã‚ã¦å¾ã€…ã«é›£åº¦ã‚’ä¸Šã’ã‚‹

ã‚·ãƒ¼ãƒ«ã‚„ã‚¹ã‚¿ãƒ³ãƒ—ãªã©è¦–è¦šçš„ã«åˆ†ã‹ã‚Šã‚„ã™ã„ã”è¤’ç¾ã¯ã€
ASDã®ãŠå­ã•ã‚“ã«ç‰¹ã«åŠ¹æœçš„ã§ã™ã€‚å°ã•ãªæˆåŠŸä½“é¨“ã‚’
ç©ã¿é‡ã­ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "è¡Œå‹•å¼·åŒ–",
                "source": "å¿œç”¨è¡Œå‹•åˆ†æï¼ˆABAï¼‰"
            }
        },
        {
            "content": """
ç’°å¢ƒèª¿æ•´ã®é‡è¦æ€§ï¼š
ç„¡ç†ã«æ…£ã‚Œã•ã›ã‚‹ã‚ˆã‚Šã‚‚ã€ã¾ãšç’°å¢ƒã‚’èª¿æ•´ã™ã‚‹ã“ã¨ãŒå„ªå…ˆã§ã™ã€‚
ã“ã‚Œã¯ã€Œåˆç†çš„é…æ…®ã€ã®è€ƒãˆæ–¹ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚

ç’°å¢ƒèª¿æ•´ã®ä¾‹ï¼ˆåºŠå±‹ã®å ´åˆï¼‰ï¼š
- ã‚¤ãƒ¤ãƒ¼ãƒãƒ•ã§ã®éŸ³ã®è»½æ¸›
- ã‚¿ã‚ªãƒ«ãƒ‰ãƒ©ã‚¤ã§ã®ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼å›é¿
- é¡ã‚’è¦‹ãªãã¦ã‚‚è‰¯ã„ä½ç½®ã¸ã®èª˜å°
- äººãŒå°‘ãªã„æ™‚é–“å¸¯ã®äºˆç´„
- æ…£ã‚ŒãŸç†å®¹å¸«ã®æŒ‡å
- æ‰€è¦æ™‚é–“ã®çŸ­ç¸®ï¼ˆå‰é«ªã ã‘ãªã©ï¼‰

å­ã©ã‚‚ã®æ„Ÿè¦šç‰¹æ€§ã«åˆã‚ã›ãŸé…æ…®ãŒã€é•·æœŸçš„ãªé©å¿œã«ã¤ãªãŒã‚Šã¾ã™ã€‚
ç„¡ç†å¼·ã„ã¯ã‚¹ãƒˆãƒ¬ã‚¹ã‚’å¢—ã‚„ã—ã€ãã®å ´æ‰€ã¸ã®ææ€–å¿ƒã‚’å¼·ã‚ã¦ã—ã¾ã„ã¾ã™ã€‚
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "ç’°å¢ƒèª¿æ•´",
                "source": "æ„Ÿè¦šçµ±åˆç™‚æ³•ãƒ»åˆç†çš„é…æ…®"
            }
        },
        {
            "content": """
é¡è¶Šã—ã®è‡ªå·±èªè­˜ã®å›°é›£ã•ï¼š
ASDã®ãŠå­ã•ã‚“ã®ä¸­ã«ã¯ã€é¡è¶Šã—ã«è‡ªåˆ†ã‚’è¦‹ã‚‹ã“ã¨ã«æ··ä¹±ã‚’æ„Ÿã˜ã‚‹å­ãŒã„ã¾ã™ã€‚
ã“ã‚Œã¯ä»¥ä¸‹ã®ç†ç”±ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ï¼š

ç†ç”±ï¼š
1. ç›´æ¥è¦‹ã‚‹è‡ªåˆ†ã¨é¡ã®ä¸­ã®è‡ªåˆ†ã®é•ã„ã®ç†è§£å›°é›£
2. å·¦å³ãŒåè»¢ã™ã‚‹ã“ã¨ã¸ã®æ··ä¹±
3. è¦–è¦šæƒ…å ±ã®å‡¦ç†è² è·ã®é«˜ã•
4. è‡ªå·±èªè­˜ã®ç™ºé”æ®µéš

å¯¾å¿œæ–¹æ³•ï¼š
- ç„¡ç†ã«é¡ã‚’è¦‹ã•ã›ãªã„
- ã€Œã¾ã£ã™ãå‰ã‚’è¦‹ã¦ã­ã€ã¨å…·ä½“çš„ãªæŒ‡ç¤º
- å¥½ããªãŠã‚‚ã¡ã‚ƒã‚„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§è¦–ç·šã‚’å›ºå®š
- é¡ã‚’å¸ƒã§è¦†ã†ï¼ˆç†å®¹å¸«ã®äº†æ‰¿ã‚’å¾—ã¦ï¼‰

é¡ã‚’è¦‹ã‚‹ã“ã¨ã‚’å¼·è¦ã™ã‚‹ã¨ã€ãƒ‘ãƒ‹ãƒƒã‚¯ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "è¦–è¦šèªçŸ¥",
                "source": "ASDèªçŸ¥ç‰¹æ€§ç ”ç©¶"
            }
        },
        {
            "content": """
å¾…ã¤ã“ã¨ã®å›°é›£ã•ã¨ãã®æ”¯æ´ï¼š
ASDã®ãŠå­ã•ã‚“ã¯ã€Œå¾…ã¤ã€ã“ã¨ãŒè‹¦æ‰‹ãªå ´åˆãŒå¤šã„ã§ã™ã€‚
ã“ã‚Œã¯æ™‚é–“æ„Ÿè¦šã®é•ã„ã‚„è¦‹é€šã—ã®æŒã¡ã«ãã•ãŒåŸå› ã§ã™ã€‚

åŠ¹æœçš„ãªå¾…ã¤ãŸã‚ã®æ”¯æ´ï¼š
1. è¦–è¦šçš„ã‚¿ã‚¤ãƒãƒ¼ï¼ˆç ‚æ™‚è¨ˆã€ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¿ã‚¤ãƒãƒ¼ï¼‰
2. æ•°å­—ã§æ®‹ã‚Šæ™‚é–“ã‚’ä¼ãˆã‚‹ï¼ˆã€Œã‚ã¨5åˆ†ã€ï¼‰
3. å¾…ã£ã¦ã„ã‚‹é–“ã®æ´»å‹•ã‚’ç”¨æ„ï¼ˆçµµæœ¬ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼‰
4. ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆçŸ­ã„æ™‚é–“ã‹ã‚‰å¾ã€…ã«å»¶ã°ã™ï¼‰
5. ã”è¤’ç¾ã®æç¤ºï¼ˆå¾…ã¦ãŸã‚‰ã‚·ãƒ¼ãƒ«ãªã©ï¼‰

ã€Œã‚‚ã†ã™ãã€ã€Œã¡ã‚‡ã£ã¨å¾…ã£ã¦ã€ãªã©ã®æ›–æ˜§ãªè¡¨ç¾ã¯é¿ã‘ã€
å…·ä½“çš„ãªæ™‚é–“ã‚„å›æ•°ã§ä¼ãˆã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "æ™‚é–“æ¦‚å¿µ",
                "source": "ASDæ”¯æ´å®Ÿè·µã‚¬ã‚¤ãƒ‰"
            }
        },
        {
            "content": """
ãƒ‘ãƒ‹ãƒƒã‚¯ã¸ã®å¯¾å¿œï¼š
ASDã®ãŠå­ã•ã‚“ãŒãƒ‘ãƒ‹ãƒƒã‚¯ã‚’èµ·ã“ã—ãŸå ´åˆã®é©åˆ‡ãªå¯¾å¿œã¯é‡è¦ã§ã™ã€‚

ãƒ‘ãƒ‹ãƒƒã‚¯æ™‚ã®å¯¾å¿œï¼š
1. å®‰å…¨ç¢ºä¿ï¼šå‘¨å›²ã®å±é™ºç‰©ã‚’é™¤å»
2. åˆºæ¿€ã®è»½æ¸›ï¼šé™ã‹ãªå ´æ‰€ã«ç§»å‹•ã€äººã‚’é ã–ã‘ã‚‹
3. è½ã¡ç€ãã¾ã§å¾…ã¤ï¼šç„¡ç†ã«æ­¢ã‚ã‚ˆã†ã¨ã—ãªã„
4. è¨€è‘‰ã‚’æœ€å°é™ã«ï¼šèª¬æ•™ã‚„èª¬æ˜ã¯é€†åŠ¹æœ
5. ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ã®æ´»ç”¨

ãƒ‘ãƒ‹ãƒƒã‚¯å¾Œï¼š
- è½ã¡ç€ã„ã¦ã‹ã‚‰åŸå› ã‚’ä¸€ç·’ã«è€ƒãˆã‚‹
- æ¬¡å›ã¸ã®å¯¾ç­–ã‚’è¦–è¦šçš„ã«ç¤ºã™
- è²¬ã‚ãªã„ã€å±ã‚‰ãªã„

äºˆé˜²ãŒæœ€ã‚‚é‡è¦ã§ã™ï¼šäº‹å‰äºˆå‘Šã€ç’°å¢ƒèª¿æ•´ã€ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã§
ãƒ‘ãƒ‹ãƒƒã‚¯ã‚’èµ·ã“ã•ãªã„ç’°å¢ƒã‚’æ•´ãˆã¾ã—ã‚‡ã†ã€‚
            """.strip(),
            "metadata": {
                "event": "åºŠå±‹",
                "category": "ãƒ‘ãƒ‹ãƒƒã‚¯å¯¾å¿œ",
                "source": "ASDå±æ©Ÿä»‹å…¥ã‚¬ã‚¤ãƒ‰"
            }
        }
    ]
    
    return knowledge_base


def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    print("=" * 80)
    print("ğŸš€ RAGçŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã—ã¾ã™")
    print("=" * 80)
    print()
    
    try:
        # RAGã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–
        print("ğŸ“¦ RAGã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–ä¸­...")
        rag_service = RAGService()
        print("âœ… RAGã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–å®Œäº†")
        print()
        
        # æ—¢å­˜ã®æ–‡æ›¸æ•°ã‚’ç¢ºèª
        existing_count = rag_service.get_collection_count()
        print(f"ğŸ“Š ç¾åœ¨ã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹: {existing_count}ä»¶")
        
        if existing_count > 0:
            confirm = input("\næ—¢å­˜ã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¾ã™ã€‚è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ (y/n): ")
            if confirm.lower() != 'y':
                print("âŒ å‡¦ç†ã‚’ä¸­æ­¢ã—ã¾ã—ãŸ")
                return
        
        print()
        
        # åˆæœŸçŸ¥è­˜ã®èª­ã¿è¾¼ã¿
        print("ğŸ“š åˆæœŸçŸ¥è­˜ã‚’èª­ã¿è¾¼ã¿ä¸­...")
        knowledge = load_initial_knowledge()
        print(f"âœ… {len(knowledge)}ä»¶ã®çŸ¥è­˜ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ")
        print()
        
        # ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã®å†…è¨³ã‚’è¡¨ç¤º
        categories = {}
        for item in knowledge:
            cat = item["metadata"].get("category", "ä¸æ˜")
            categories[cat] = categories.get(cat, 0) + 1
        
        print("ğŸ“‹ ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥å†…è¨³:")
        for cat, count in categories.items():
            print(f"  - {cat}: {count}ä»¶")
        print()
        
        # çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã«è¿½åŠ 
        print("ğŸ’¾ çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã«è¿½åŠ ä¸­...")
        success = rag_service.add_documents(knowledge)
        
        if success:
            new_count = rag_service.get_collection_count()
            added_count = new_count - existing_count
            print(f"âœ… è¿½åŠ å®Œäº†ï¼ {added_count}ä»¶ã®æ–‡æ›¸ã‚’è¿½åŠ ã—ã¾ã—ãŸ")
            print(f"ğŸ“Š ç¾åœ¨ã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹: {new_count}ä»¶")
            print()
            
            # ãƒ†ã‚¹ãƒˆæ¤œç´¢
            print("=" * 80)
            print("ğŸ” ãƒ†ã‚¹ãƒˆæ¤œç´¢ã‚’å®Ÿè¡Œ")
            print("=" * 80)
            print()
            
            test_queries = [
                ("ãƒãƒªã‚«ãƒ³ã®éŸ³ã§å­ã©ã‚‚ãŒãƒ‘ãƒ‹ãƒƒã‚¯ã«ãªã‚‹", "åºŠå±‹"),
                ("ã˜ã£ã¨åº§ã£ã¦ã„ã‚‰ã‚Œãªã„", "åºŠå±‹"),
                ("é¡ã‚’è¦‹ã‚‹ã®ã‚’å«ŒãŒã‚‹", "åºŠå±‹")
            ]
            
            for i, (query, event) in enumerate(test_queries, 1):
                print(f"\nã€ãƒ†ã‚¹ãƒˆ {i}ã€‘")
                print(f"ã‚¯ã‚¨ãƒª: {query}")
                print(f"ã‚¤ãƒ™ãƒ³ãƒˆ: {event}")
                print("-" * 80)
                
                context = rag_service.retrieve_relevant_context(
                    query=query,
                    event=event,
                    top_k=2
                )
                
                if context:
                    # æœ€åˆã®200æ–‡å­—ã®ã¿è¡¨ç¤º
                    preview = context[:200] + "..." if len(context) > 200 else context
                    print(preview)
                else:
                    print("æ¤œç´¢çµæœãªã—")
                print()
            
            print("=" * 80)
            print("ğŸ‰ RAGçŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
            print("=" * 80)
            
        else:
            print("âŒ çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã¸ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")
            return 1
            
    except Exception as e:
        print(f"\nâŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")
        import traceback
        traceback.print_exc()
        return 1
    
    return 0


if __name__ == "__main__":
    sys.exit(main())

